parameters:
- name: serviceConnection
  type: string

steps:
- powershell: |
    $path = "$(Pipeline.Workspace)/ConfigurationMigrationData-$(EnvironmentName).zip"
    Write-Host "##vso[task.setvariable variable=ConfigurationMigrationFilePath]$path"
    $microsoftConfigurationMigrationPowerShellModule = '$(Microsoft_Xrm_Tooling_ConfigurationMigration)'
    Import-Module $microsoftConfigurationMigrationPowerShellModule -RequiredVersion $(configurationMigrationPowerShellVersion) -Force
    Export-CrmDataFile -SchemaFile "$(Build.SourcesDirectory)\Config\configuration-data-schema.xml" -DataFile $path -CrmConnection "$(CdsBaseConnectionString)${{parameters.serviceConnection}}" -Verbose
  displayName: 'Export Configuration Data'