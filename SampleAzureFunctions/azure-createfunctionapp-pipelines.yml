# This pipeline creates Storage account ; Service Plan and Azure Functionapp

trigger:
- none

pool:
  vmImage: windows-latest

steps:
- checkout: none
- script: 'echo "BuildId = $(Build.BuildId)"' 
  displayName: Create Storage Account
- task: AzureCLI@2
  inputs:
    azureSubscription: 'azabdp-sc-main-001'
    scriptType: 'ps'
    scriptLocation: 'inlineScript'
    inlineScript: 'az storage account create --name azdbdpeuwstsherlock006 --resource-group azdbdpeuw-rg-sherlock006 --location westeurope --sku Standard_RAGRS --kind StorageV2 --public-network-access Disabled --allow-blob-public-access false --enable-hierarchical-namespace true --allow-cross-tenant-replication false --min-tls-version TLS1_2 --tags Region=EUW Environment=DEV CostCenter=TBD CostResponsible=TBD Country=TBD'
- script: 'echo "BuildId = $(Build.BuildId)"' 
  displayName: Create Service Plan
- task: AzureCLI@2
  inputs:
    azureSubscription: 'azabdp-sc-main-001'
    scriptType: 'ps'
    scriptLocation: 'inlineScript'
    inlineScript: 'az appservice plan create --name azdbdpeuw-plan-sherlock-006 --resource-group azdbdpeuw-rg-sherlock006 --location westeurope --sku P1V3 --tags Region=EUW Environment=DEV CostCenter=TBD CostResponsible=TBD Country=TBD'
- script: 'echo "BuildId = $(Build.BuildId)"' 
  displayName: Create Function App
- task: AzureCLI@2
  inputs:
    azureSubscription: 'azabdp-sc-main-001'
    scriptType: 'ps'
    scriptLocation: 'inlineScript'
    inlineScript: 'az functionapp create -p azdbdpeuw-plan-sherlock-006 --name azdbdpeuw-func-sherlock-006 --storage-account azdbdpeuwstsherlock006 --resource-group azdbdpeuw-rg-sherlock006 --tags Region=EUW Environment=DEV CostCenter=TBD CostResponsible=TBD Country=TBD'
